#!/bin/sh
set +e # doesn't automatically exit on error

# Check if npm and eslint exist
if command -v npm >/dev/null 2>&1 && command -v eslint >/dev/null 2>&1; then
  echo "✅ Running lint-staged on host..."
  npx lint-staged
  STATUS=$?
else
  echo "⚠️  npm or eslint not found on host. Running lint:fix inside Docker..."
  docker compose run -T --rm dev sh -c "npm run lint:fix"
  STATUS=$?
fi

if [ $STATUS -ne 0 ]; then
  echo "❌ Auto-fix failed. Please review changes before committing."
  exit 1
fi

echo "✅ Linting applied successfully."
exit 0
